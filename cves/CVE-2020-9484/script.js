$("#uploadButton").click(function(){
  $("#uploadFile").click();
});

$(document).ready(function(){
  ImageUpload.init();
});

var ImageUpload = {
  init:function() {
    $("#uploadFile").change(function(){
        ImageUpload.readURL(this);
    });
  },
  readURL:function(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
		/*
          $('.header').css(
              "background-image",
              "url(" + e.target.result + ")"
            );
          $(".clipped").css(
            "background-image",
            "url(" + e.target.result + ")"
          ); */
        } 
        reader.readAsDataURL(input.files[0]); 
    }
  },
}

async function upload() {
  let photo = document.getElementById("uploadFile").files[0];
  let req = new XMLHttpRequest();
  let email = document.getElementById("email").value;
  let formData = new FormData();

  formData.append("image", photo);

  await fetch('/upload.jsp?email=' + email , { method: "POST", body: formData})
    .then(response=>response.text())
    .then(data=>{ 
	    if(data.includes("successfully")) {
		    document.getElementById("msg").innerText = "Upload successful! The report will be sent via e-mail.";
	    }
	    else {
		    document.getElementById("msg").innerText = "File upload failed";
	    }
    })
    .catch(function(error) { 
	    document.getElementById("msg").innerText = "File upload failed";
    });
	
}
