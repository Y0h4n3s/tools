<%--
  Created by IntelliJ IDEA.
  User: y0h4n3s
  Date: 12/3/20
  Time: 9:15 AM
  To change this template use File | Settings | File Templates.
--%>
<%@ page import = "java.io.*,java.util.*, javax.servlet.*" %>
<%@ page import = "javax.servlet.http.*" %>
<%@ page import = "org.apache.commons.fileupload.*" %>
<%@ page import = "org.apache.commons.fileupload.disk.*" %>
<%@ page import = "org.apache.commons.fileupload.servlet.*" %>
<%@ page import = "org.apache.commons.io.output.*" %>

<%
    final String UPLOAD_ROOT = "/opt/tomcat/tomcat-9.0.27/uploads/";
    int maxFileSize = 5000;
    int maxMemSize = 50;
    // Verify the content type
    boolean isMultipart = ServletFileUpload.isMultipartContent(request);   
    if (isMultipart) {
        try {
            DiskFileItemFactory factory = new DiskFileItemFactory();
            factory.setSizeThreshold(maxMemSize);
            ServletContext servletContext = this.getServletConfig().getServletContext();
            File repository = new File("/opt/tomcat/tomcat-9.0.27/temp"); 
            factory.setRepository(repository);
            ServletFileUpload upload = new ServletFileUpload(factory);
            List<FileItem> items = upload.parseRequest(request);
            
        //save files to disk
            for (FileItem item : items) {
                File localFile = new File(UPLOAD_ROOT + item.getName());
                item.write(localFile);
            }
        } catch (Exception e) {
            out.println(e);
        }
    }
    
%>
